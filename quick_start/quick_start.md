# WeTest UITrace 快速开始
## 模式选择
工具支持两种使用模式：
### [1.场景模式](#场景模式)
通过截图创建场景，并设置场景下的操作。运行时工具识别到该场景则执行对应操作。  
简单任务无需代码即可实现自动化脚本。  
易于处理偶现场景。
### [2.代码模式](#代码模式)
基于Python编写自动化脚本，与常规自动化工具类似。

## 场景模式
### 1.连接手机
1. USB线连接安卓手机，打开USB调试：*设置-开发者选项-USB调试*，参考[官方文档](https://developer.android.com/studio/debug/dev-options.html#debugging)；  
2. 工具点击 *连接设备*，建议使用默认 *WeTest* 连接方式，点击 *连接*。

### 2.创建工程
1. 运行 *WeTestUITrace.exe* 启动工具，点击 *场景模式*。

### 3.设置项目信息
1. 点击 *项目信息*，填写相关内容，其中 *Package*、*Activity* 信息，可通过点击 *从apk包获取*（从被测项目apk包获取）或 *从当前app获取*（从手机当前运行的被测app首页获取）自动填写。

### 4.创建脚本
<video src="./create_scene.m4v" controls="controls" width="768" height="416">您的浏览器不支持播放该视频！</video>  
1. 创建智能场景  
+ 标识对象：  
在测试画面，点击 *新建场景*，在 *设备窗* 中截取图像，该图像默认作为场景的标识对象（*对象详情-对象类型* 中可查看图像类型）。执行脚本时，根据此图判断设备是否运行到该场景，运行到则执行对应场景操作；  
+ 操作对象：  
再次在 *设备窗* 中截取一张图像，该图像默认作为场景的操作对象（*对象详情-对象类型* 中可查看图像类型），可在 *对象详情-常用操作* 中选择执行的操作（支持[自定义脚本](#自定义脚本)），执行脚本时，如通过标识识别到该场景，会匹配场景中的操作图像，匹配到后会执行该操作图像上设置的操作。  
2. 创建多个智能场景即可实现自动化脚本，脚本执行时通过场景标识判断设备运行到了哪个场景，通过匹配场景操作执行对应的操作；  
3. 点击 *设备窗* 下方的 *保存* 以保存设置，返回到手机实时画面。

### 5.执行
1. 点击 *运行* 执行脚本，可在 *输出* 框内查看执行情况；或点击 *导出* 打包脚本，可上传到WeTest云真机平台等执行脚本。

### <a id="自定义脚本">6.自定义脚本（补充）</a>
<video src="./add_func.m4v" controls="controls" width="768" height="416">您的浏览器不支持播放该视频！</video>  
如预置的操作无法满足需求，可以自定义操作脚本添加到操作图像上：  
1. 点击 *添加函数* ，编写自定义脚本函数，支持基于图像匹配和安卓控件的操作方式，支持多种API，详见[代码模式-创建脚本](#创建脚本)；  
2. 点击需要添加自定义执行脚本的场景操作对象，在 *对象详情-常用操作* 中选择 *预置脚本* ， 在 *函数名称* 中选择自定义脚本的函数名即可。

## 代码模式
### 1.连接手机
1. USB线连接安卓手机，打开USB调试：*设置-开发者选项-USB调试*，参考[官方文档](https://developer.android.com/studio/debug/dev-options.html#debugging)；  
2. 工具点击 *连接设备*，建议使用默认 *WeTest* 连接方式，点击 *连接*。

### 2.创建工程
1. 运行 *WeTestUITrace.exe* 启动工具，点击 *代码模式*。  

### 3.设置项目信息
1. 点击 *项目信息*，填写相关内容，其中 *Package*、*Activity* 信息，可通过点击 *从apk包获取*（从被测项目apk包获取）或 *从当前app获取*（从手机当前运行的被测app首页获取）自动填写。

### <a id="创建脚本">4.创建脚本</a>
<video src="./add_script.m4v" controls="controls" width="768" height="416">您的浏览器不支持播放该视频！</video>
基于Python在 *主脚本* 窗中编写执行脚本，支持基于图像匹配和安卓控件两种主要方式混合编写，支持多种API：  
1. 基于图像匹配的编写  
+ 按住键盘 *Ctrl*，将鼠标移至 *设备窗* 手机画面上，按住 *鼠标左键* 可以截选图像区域；  
+ 在选定区域点击 *鼠标右键* 可以在列表中选择操作，如选择 *点击* ，在 *主脚本* 中会生成click(***)的点击代码，在执行脚本时如匹配到该截图，则会点击图像中心位置；  
+ 在 *主脚本* 右侧的 *常用操作* 栏中可以查看常用API，点击可快速生成到对应脚本；全部API可以拉至最下面点击 *查看更多* 或在 *帮助-API* 中查看。   
2. 基于安卓控件的编写（游戏、网页等非安卓控件的无法使用）  
+ 点击 *控件* ，在弹出窗口 *UITree* 中可以看到当前手机画面的控件树，在 *设备窗* 手机画面区域进行鼠标操作， *主脚本* 中会自动生成基于控件的操作脚本；  
+ 工具也支持直接在 *主脚本* 中根据提供的API编写安卓控件的相关操作。

### 5.执行
1. 点击 *运行* 执行脚本，可在 *输出* 框内查看执行情况；或点击 *导出* 打包脚本，可上传到WeTest云真机平台等执行脚本。

### 6.录制（补充）
为了方便编写脚本，工具提供了基于相对坐标、图像、安卓控件三种录制功能：  
1. 基于坐标的录制  
将鼠标移至 *录制* 按钮，在出现的下拉菜单中选择手机录制/电脑录制（部分新安卓系统不支持电脑录制）即可开启相对坐标录制功能，操作手机实体/鼠标在 *设备窗* 手机画面中操作，*主脚本* 会自动生成对应脚本。  
2. 基于图像的录制  
将鼠标移至 *录制* 按钮，在出现的下拉菜单中选择智能录制即可开启基于图像的录制，操作手机实体/鼠标在 *设备窗* 手机画面中操作（部分新安卓系统不支持电脑上操作），*主脚本* 会自动生成对应脚本。该方式根据点击操作位置智能截取图像用于执行时的匹配，同时会记录滑动操作意图，在找不到操作图像时会根据上一步滑动操作进行滑动查找。  
3. 基于安卓控件的录制  
点击 *控件* ，在弹出窗口 *UITree* 中可以看到当前手机画面的控件树，在 *设备窗* 手机画面区域进行鼠标操作， *主脚本* 中会自动生成基于控件的操作脚本。

## 功能特色
| 模块 | 功能 |
| :-: | - |
| 设备连接 | 支持安卓10、11等新系统 |
| 开发模式 | 场景模式：低门槛，简单任务无需代码；易于处理偶现场景<br>代码模式：更灵活，基于Python编写自动化脚本 |
| 场景模式 | 易用：通过截图和设置即可实现简单脚本<br>强大：可设置为偶现场景用于处理偶现情况<br>直观：大纲、工作流视图|
| 代码模式 | 灵活：基于Python编写自动化脚本，丰富的API<br>强大：支持unittest、pytest等用例管理|
| 识别方式 | 坐标、图像、OCR、安卓控件、复合 |
| 执行环境 | WeTest云真机平台<br>Windows脚本、Linux脚本、Windows IDE，可离线使用 |
| 录制 | 智能录制：根据操作位置智能截图，智能判断滑动意图<br>安卓控件录制<br>坐标录制 |
| 智能处理 | 自动处理系统、权限弹窗<br>自动拉起APP、游戏<br>QQ登录、微信登录等常用操作封装 |
| 智能Monkey | 支持一键生成及API调用<br>支持控件及AI图像识别两种方式<br>Web、键盘、简单登录等智能处理 |
| 扩展性 | 40+API，自由扩展<br>支持用户库封装<br>支持工具配置修改 |
| 丰富工具 | 支持导入图片创建场景<br>支持导入图片匹配查找，便于优化脚本、定位问题 |